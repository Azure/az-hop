#!/bin/bash

if [[ $1 == "cyclecloud" ]]; then
  echo go create tunnel to cyclecloud at https://localhost:9443/cyclecloud
  ssh -i {{outputs.admin_user}}_id_rsa -fN -L 9443:ccportal:9443 -p {{access.jumpbox_port}} {{outputs.admin_user}}@{{access.jumpbox_host}}
elif [[ $1 == "ad" ]]; then
  echo go create tunnel to ad with rdp to localhost:3390
  ssh -i {{outputs.admin_user}}_id_rsa -fN -L 3390:ad:3389 -p {{access.jumpbox_port}} {{outputs.admin_user}}@{{access.jumpbox_host}}
else
  exec ssh -i {{outputs.admin_user}}_id_rsa -o ProxyCommand="ssh -i {{outputs.admin_user}}_id_rsa -p {{access.jumpbox_port}} -W %h:%p {{outputs.admin_user}}@{{access.jumpbox_host}}" "$@"
fi
