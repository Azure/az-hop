#!/bin/bash
script_dir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
source "$script_dir/../files/azhop-helpers.sh" 
read_os

find $script_dir/../files -name "*.sh" -exec chmod +x {} \;

{% for group in usergroups %}
groupadd -g {{ group.gid }} {{ group.name }}
{% endfor %}

{% for user in users %}
useradd -u {{ user.uid }} {{ user.name }} -G {{ usergroups | selectattr('gid', 'in', (user.groups | default([], true))) | map(attribute='name') | join(',') }} -b {{ mounts.home.mountpoint }} -s {{user.shell | default('/bin/bash')}}
{% endfor %}
