---
clusters:
  ondemand:
    v2:
      metadata:
        title: AZHOP - Cluster
      login:
        host: ondemand
      job:
        host: scheduler
      batch_connect:
        min_port: 61001
        max_port: 61010
        basic:
          min_port: 61001
          max_port: 61010
          script_wrapper: |
            module purge
            %s
        vnc:
          min_port: 61001
          max_port: 61010
          script_wrapper: |
            module purge
            export PATH="/opt/TurboVNC/bin:$PATH"
            export WEBSOCKIFY_CMD="/usr/bin/websockify"
            %s

ood_install_apps:
  codeserver:
    dest: "{{ ood_sys_app_dir }}"
    version: master

ood_apps:
  dashboard:
    env:
      ood_bc_dynamic_js: true

  bc_desktop:
    title: "Linux Desktop"
    cluster: ondemand
    icon: fa://linux
    form:
      - desktop
      - target
      - num_hours
      - bucket
    attributes:
      desktop: xfce
      target:
        widget: "select"
        label: "Session target"
        help: |
          Select the resource target for the remote desktop session <br>
          - **With GPU** <br>
            These are standard small GPU nodes for visualization for a single user session.<br>
          - **Large With GPU** <br>
            These are standard large GPU nodes for visualization, usually for multiple users sessions sharing the same node.<br>
          - **Without GPU** <br>
            Same as for **With GPU** but without a GPU accelerator.
        options:
         - ["With GPU - Small GPU node for single session", "viz3d", data-hide-bucket: true, data-set-bucket: 100, data-max-num-hours: 12, data-min-num-hours: 1]
         - ["Large With GPU - Intented for shared sessions", "largeviz3d", data-max-num-hours: 168, data-min-num-hours: 1]
         - ["Without GPU - for single session", "viz", data-hide-bucket: true, data-set-bucket: 100, data-max-num-hours: 12, data-min-num-hours: 1]
        #  - ["With GPU - Small GPU node for single session", "viz3d", data-hide-reservedcores: true, data-set-reservedcores: 0, data-max-num-hours: 12, data-min-num-hours: 1]
        #  - ["Large With GPU - Intented for shared sessions", "largeviz3d", data-hide-reservedcores: false, data-max-reservedcores: 48, data-min-reservedcores: 0, data-max-num-hours: 168, data-min-num-hours: 1]
        #  - ["Without GPU - for single session", "viz", data-hide-reservedcores: true, data-set-reservedcores: 0, data-max-num-hours: 12, data-min-num-hours: 1]
      num_hours:
        widget: "number_field"
        label: "Maximum duration in hours of your remote session"
        value: 1
        help: |
          This is the maximum duration in hours of your remote session once started. <br> 
        step: 1
      bucket:
        widget: "select"
        label: "Node bucket"
        help: |
          Select how much of the node you want to use <br>
        options:
         - [" 25 %", "25"]
         - [" 50 %", "50"]
         - ["100 %", "100"]

      # reservedcores:
      #   widget: "number_field"
      #   label: "Maximum number of cores of your remote session"
      #   value: 4
      #   help: |
      #     This is the maximum number of cores used on a shared node. <br>
      #     Enter a value between 0 and 48. <strong>0 means all cores are used</strong>.
      #   step: 1

host_regex: '[^./]+'
node_uri: '/node'
rnode_uri: '/rnode'

pun_custom_env:
  OOD_DASHBOARD_TITLE: "Azure HPC On-Demand Platform"
  OOD_DASHBOARD_LOGO: "/public/logo.png"
  OOD_BRAND_BG_COLOR: "#0078d4"
  OOD_BRAND_LINK_ACTIVE_BG_COLOR: "#212529"
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"
  GUAC_SPOOLER_DIRECTORY: "{{mounts.home.mountpoint}}/guac-spool"

# See https://osc.github.io/ood-documentation/latest/customization.html#pinning-applications-to-the-dashboard
pinned_apps:
  - category: 'Interactive Apps'
  # - sys/shell/ssh/ondemand
