---
- name: Remove domain users
  hosts: ad
  vars_files:
    - '{{global_config_file}}'

  tasks:
  - name: Remove users
    community.windows.win_domain_user:
      name: "{{ item.name }}"
      state: absent
    with_items: '{{users}}'
    when: users is defined

- name: Remove Users
  hosts: ondemand
  become: true
  vars_files:
    - '{{global_config_file}}'

  tasks:
  - include: remove_homedir.yml user="{{item}}"
    with_items: '{{users}}'
    when: users is defined
