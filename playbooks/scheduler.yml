---
- hosts: scheduler
  become: true
  vars_files:
    - '{{global_config_file}}'

  tasks:
  - name: Read Password from KV
    command: az keyvault secret show --vault-name {{key_vault}} -n {{admin_user}}-password --query "value" -o tsv
    delegate_to: 127.0.0.1
    register: password
    become: false
    
  - include_role: 
      name: pbsserver
      apply: 
        become: true
    vars:
      cc_admin: '{{admin_user}}'
      cc_password: '{{password.stdout}}'
