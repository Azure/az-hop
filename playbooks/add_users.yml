---
- name: Add domain users
  hosts: ad
  vars_files:
    - '{{global_config_file}}'

  tasks:
  - include: create_user.yml user="{{item}}"
    with_items: '{{users}}'
    when: users is defined

- name: Configure Users
  hosts: localhost
  become: true
  vars_files:
    - '{{global_config_file}}'

  tasks:
  - include: init_user.yml user="{{item}}"
    with_items: '{{users}}'
    when: users is defined

- name: Configure users in CycleCloud
  hosts: ccportal
  become: true
  vars_files:
    - '{{global_config_file}}'

  tasks:
  - name: Add users
    template:
      src: user_record.txt.j2
      dest: /opt/cycle_server/config/data/user_record.txt
