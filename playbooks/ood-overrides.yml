---
clusters:
  ondemand:
    v2:
      metadata:
        title: AZHOP - Cluster
      login:
        host: ondemand
      job:
        adapter: pbspro
        host: scheduler
        exec: /opt/pbs
      batch_connect:
        basic:
          script_wrapper: |
            module purge
            %s
        vnc:
          script_wrapper: |
            module purge
            export PATH="/opt/TurboVNC/bin:$PATH"
            export WEBSOCKIFY_CMD="/usr/bin/websockify"
            %s
ood_install_apps:
  codeserver:
    repo: https://github.com/edwardsp/bc_osc_codeserver.git
    dest: "{{ ood_sys_app_dir }}"
    version: master
ood_apps:
  bc_desktop:
    title: "remote desktop"
    cluster: ondemand
    form:
      - desktop
      - hours
    attributes:
      desktop: xfce
      hours:
        widget: "number_field"
        label: "Maximum duration of your remote session"
        value: 1
        help: |
          This is the maximum duration of your remote session once started. Enter a value between 1 and 8
        min: 1
        max: 8
        step: 1
        id: 'hours'
    submit: |
      ---
      script:
        native:
          - "-l"
          - "select=1:ncpus=6:slot_type=viz3d"
          - "-l"
          - "walltime=<%= '%02d:00:00' % hours %>"
httpd_auth:
- AuthType openid-connect
- Require valid-user
user_map_cmd: "/opt/ood/ood_auth_map/bin/ood_auth_map.regex --regex=''^(\\w+)@microsoft.com$''"
host_regex: '[^./]+'
node_uri: '/node'
rnode_uri: '/rnode'
logout_redirect: '/oidc?logout=https%3A%2F%2F{{ servername }}'
oidc_uri: /oidc
#oidc_provider_metadata_url: https://sts.windows.net/{{tenant_id}}/.well-known/openid-configuration
# setting ood_auth_openidc will create a separate configuration auth file for apache 
ood_auth_openidc:
  OIDCProviderMetadataURL: 'https://sts.windows.net/{{tenant_id}}/.well-known/openid-configuration'
  OIDCClientID: '{{aad_app_id}}'
  OIDCClientSecret: '{{ oidc_client_secret }}'
  OIDCRemoteUserClaim: 'upn'
  OIDCScope: 'openid profile email groups'
  OIDCCryptoPassphrase: '{{ oidc_client_secret }}'
  OIDCPassIDTokenAs: 'serialized'
  OIDCPassRefreshToken: 'On'
  OIDCPassClaimsAs: 'environment'

#oidc_client_id: '{{aad_app_id}}'
#oidc_remote_user_claim: upn
#oidc_scope: 'openid profile email groups'
# oidc_settings:
#   OIDCPassIDTokenAs: 'serialized'
#   OIDCPassRefreshToken: 'On'
#   OIDCPassClaimsAs: 'environment'

pun_custom_env:
  OOD_DASHBOARD_TITLE: "Azure HPC On-Demand Platform"
  OOD_DASHBOARD_LOGO: "/public/logo.png"
  OOD_BRAND_BG_COLOR: "#0078d4"
  OOD_BRAND_LINK_ACTIVE_BG_COLOR: "#fff"
  OOD_JOB_NAME_ILLEGAL_CHARS: "/"