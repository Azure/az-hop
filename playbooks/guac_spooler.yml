---
- hosts: guacamole
  gather_facts: no
  become: true
  vars_files:
    - '{{global_config_file}}'
  vars:
    cyclecloud_guac_version: 0.1.16

  tasks:
  - name: Wait 300 seconds for the nodes to be ready
    wait_for_connection:
      timeout: 300
  - name: Gather facts for first time
    setup:

  - name: Install Guac Spooler
    include_role:
      name: guac_spooler
    vars:
      guac_spooler_key_vault: "{{key_vault}}"
      guac_spooler_admin_user: "{{admin_user}}"
      guac_spooler_slurmdb_user: "{{ slurmdb_user }}"
      guac_spooler_slurmdb_fqdn: "{{slurmdb_fqdn}}"
      guac_spooler_mountpoint: "{{ homedir_mountpoint }}"

